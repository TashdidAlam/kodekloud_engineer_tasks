# Question
We have a web server container running the nginx image. The access and error logs generated by the web server are not critical enough to be placed on a persistent volume. However, Nautilus developers need access to the last 24 hours of logs so that they can trace issues and bugs. Therefore, we need to ship the access and error logs for the web server to a log-aggregation service. Following the separation of concerns principle, we implement the Sidecar pattern by deploying a second container that ships the error and access logs from nginx. Nginx does one thing, and it does it well—serving web pages. The second container also specializes in its task—shipping logs. Since containers are running on the same Pod, we can use a shared emptyDir volume to read and write logs.

**Create a `pod` named `webserver`.**

**Create an `emptyDir` volume `shared-logs`.**

**Create two containers from `nginx` and `ubuntu` images with `latest` tag only and remember to mention tag i.e `nginx:latest`, nginx container name should be `nginx-container` and ubuntu container name should be `sidecar-container` on webserver pod.**

**Add command on sidecar-container `"sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"`**

**Mount the volume `shared-logs` on both containers at location `/var/log/nginx`, all containers should be up and running.**

**Note: The `kubectl` utility on `jump_host` has been configured to work with the kubernetes cluster.**

<span style="color: red;">The below commands based on different question server, user name & other details that might differ. So please read the task carefully before executing it. </span>

---

## Step-by-Step Solution

**Step 1: Create the pod manifest YAML file**

- Use a text editor to create the pod definition file:

```bash
vi webserver.yml
```
> *Opens the file `webserver.yml` for editing. This file will define the pod, containers, and shared volume.*

- Add the following content to `webserver.yml`:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webserver
spec:
  volumes:
  - name: shared-logs
    emptyDir: {}
  containers:
  - name: nginx-container
    image: nginx:latest
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx
  - name: sidecar-container
    image: ubuntu:latest
    command: ["sh", "-c", "while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"]
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx
```
> *Defines a pod with two containers: one running nginx and one running ubuntu as a sidecar for log shipping. Both containers mount the same `emptyDir` volume at `/var/log/nginx`.*

---

**Step 2: Create the pod using kubectl**

- Apply the manifest to create the pod:

```bash
kubectl apply -f webserver.yml
```
> *Creates the pod in the cluster using the configuration defined in `webserver.yml`.*

---

**Step 3: Verify the sidecar container is shipping logs**

- Check the logs of the sidecar container to confirm it is reading and outputting nginx logs:

```bash
kubectl logs -f webserver -c sidecar-container
```
> *Streams the logs from the sidecar container, showing the output of the log shipping command. This confirms the sidecar pattern is working as intended.*